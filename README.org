#+TITLE:   calibredb.el
#+DATE:    May 13, 2020
#+SINCE:   <replace with next tagged release version>
#+STARTUP: inlineimages nofold

* Table of Contents :TOC_3:noexport:
- [[#description][Description]]
- [[#screenshots][Screenshots]]
  - [[#dashboard][Dashboard]]
  - [[#quick-search-filter-with-helm-and-ivy][Quick search, filter with helm and ivy]]
  - [[#another-bookmarks-solution][Another bookmarks solution]]
    - [[#add-tags][Add tags]]
    - [[#add-comments][Add comments]]
- [[#installation][Installation]]
  - [[#install-calibredbel][Install calibredb.el]]
    - [[#ues-package][ues-package]]
    - [[#doom-emacs][Doom Emacs]]
    - [[#spacemacs-or-other-emacs-distributions][Spacemacs or other emacs distributions]]
- [[#configuration][Configuration]]
  - [[#enable-calibredbel][Enable calibredb.el]]
- [[#workflows][Workflows]]
- [[#supported-features][Supported Features]]
  - [[#calibredb][calibredb]]
  - [[#calibredb-find-helm][calibredb-find-helm]]
  - [[#calibredb-find-counsel][calibredb-find-counsel]]
  - [[#calibredb-list][calibredb-list]]
  - [[#calibredb-clone][calibredb-clone]]
  - [[#calibredb-switch-library][calibredb-switch-library]]
  - [[#show-details][Show details]]
  - [[#add][add]]
  - [[#remove][remove]]
  - [[#show_metadata][show_metadata]]
  - [[#set_metadata][set_metadata]]
    - [[#--filed-tags][=--filed tags=]]
    - [[#--filed-comments][=--filed comments=]]
    - [[#--list-fields][=--list-fields=]]
  - [[#export][Export]]
- [[#logs][Logs]]
  - [[#2020-05-14][=2020-05-14=]]
  - [[#2020-05-13][=2020-05-13=]]
  - [[#2020-05-10][=2020-05-10=]]
  - [[#2020-05-09][=2020-05-09=]]

* Description
Yet another [[https://calibre-ebook.com/][calibre]] emacs client.

Inspired by [[https://github.com/whacked/calibre-mode][calibre-mode]], this package integrates calibre (using *calibredb*) into emacs.

1. Manage ebooks, actually not only ebooks!
2. Manage libraries.
2. Another bookmarks solution, by setting the tags and comments.
3. Quick search, filter, make actions on items with ivy and helm.
4. Ebook dashboard.

* Screenshots
** Dashboard
[[img/search.png]]
[[img/dashboard.png]]

** Quick search, filter with helm and ivy
[[img/helm.png]]
[[img/ivy.png]]
** Another bookmarks solution
*** Add tags
[[img/tag.gif]]
*** Add comments
[[img/comment.gif]]

* Installation

Then install this package:

** Install calibredb.el
Choose one of the following installation methods based on your needs:

*** ues-package

#+BEGIN_SRC emacs-lisp
(use-package calibredb
  :quelpa
  (calibredb :repo "chenyanming/calibredb.el" :fetcher github))
#+END_SRC

*** Doom Emacs
Add the following line to =package.el=
#+BEGIN_SRC emacs-lisp
(package! calibredb :recipe (:host github :repo "chenyanming/calibredb.el"))
#+END_SRC

Run =./.emacs.d/bin/doom sync=

*** Spacemacs or other emacs distributions
Put =calibredb.el= to your load-path. Here is example of ~spacemacs~

#+BEGIN_SRC sh
git clone git@github.com:chenyanming/calibredb.el.git ~/.emacs.d/private/calibredb.el
#+END_SRC

#+BEGIN_SRC emacs-lisp
(add-to-list 'load-path (expand-file-name "~/.emacs.d/private/calibredb.el"))
(require 'calibredb)
#+END_SRC

* Configuration

** Enable calibredb.el

#+BEGIN_SRC emacs-lisp
(require 'calibredb)
(setq sql-sqlite-program "/usr/bin/sqlite3")
(setq calibredb-root-dir (expand-file-name "~/OneDrive/Doc/Calibre"))
(setq calibredb-db-dir (concat calibredb-root-dir "/metadata.db"))
(setq calibredb-program "/Applications/calibre.app/Contents/MacOS/calibredb")
#+END_SRC

* Workflows
There are three ways to manage your ebooks at this moment:
1. Start with =calibredb=
    - =M-x calibredb= to enter ebook dashboard (buffer =*calibredb-search*=)
    - =Enter= or =mouse-3= to enter ebook details (buffer =*calibredb-entry*=)
2. Start with =calibredb-find-helm= or =calibredb-find-counsel=
    - =M-x calibredb-find-helm= or =calibredb-find-counsel= to enter the ebook list
    - =C-i= (Helm) =C-o= (Counsel) to enter the action menus.
3. Start with =calibredb-list=
    - =M-x calibredb-list= to enter ebook dashboard (buffer =*calibredb-list*=)

PS:
1. Keymapping could be configured in future versions.
2. Workflows may be slightly changed in future versions.

* Supported Features

For more details on the actions, check the official calibre documents:
https://manual.calibre-ebook.com/generated/en/calibredb.html

** calibredb
Enter calibre emacs client, a new buffer called =*calibredb-search*= with =calibredb-search-mode=
#+BEGIN_SRC emacs-lisp
M-x calibredb
#+END_SRC
=RET= or =mouse-3= to open the entry
TODO:
    - Multiple dashboard with different libraries.
    - Sorting.

** calibredb-find-helm
Use helm to list all ebooks
#+BEGIN_SRC emacs-lisp
M-x calibredb-find-helm
#+END_SRC

** calibredb-find-counsel
Use counsel to list all ebooks
#+BEGIN_SRC emacs-lisp
M-x calibredb-find-counsel
#+END_SRC

** calibredb-list
Generate an org buffer which contains all files' cover images, titles and the file links.
#+BEGIN_SRC emacs-lisp
M-x calibredb-list
#+END_SRC

** calibredb-clone
Create a clone of the current library. This creates a new, empty library that
has all the same custom columns, Virtual libraries and other settings as the
current library.

#+BEGIN_SRC emacs-lisp
M-x calibredb-clone
#+END_SRC

Tips: Libraries can be used for any purposes, one for books, one for
lecture notes, one for research references etc.

** calibredb-switch-library
Switch a library temporary. With this feature, you can manage as many libraries
for any purpose as you want!

#+BEGIN_SRC emacs-lisp
M-x calibredb-switch-library
#+END_SRC

PS: Setting will lost after you reboot.
TODO: Permanent switching.

** Show details
This action will get you to the book details buffer called =*calibredb-entry*=
with =calibredb-show-mode=, you can make actions on it, just like =magit-dispatch=,

Under =*calilbredb-entry*= buffer, call
#+BEGIN_SRC emacs-lisp
M-x calibredb-dispatch
#+END_SRC
Or fire with keybinding =C-c g=

Demo:
[[img/details.gif]]

** add
To add a file into calibre, call
#+BEGIN_SRC emacs-lisp
M-x calibredb-add
#+END_SRC

** remove
Remove a item.

** show_metadata

** set_metadata
*** =--filed tags=
*** =--filed comments=
*** =--list-fields=

** Export

* Logs
** =2020-05-14=
Version *1.3.0*:
- =calibredb-clone=
- =calibrede-switch-library=

** =2020-05-13=
Version *1.2.0*:
- =calibredb-export=
- =calibredb=

** =2020-05-10=
Version *1.1.0*:
- =calibredb-dispatch=

** =2020-05-09=
Version *1.0*.0:
- =calibredb-find-helm=
- =calibredb-find-counsel=
- =calibredb-list=
